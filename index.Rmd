---
title: "Visualization and analysis of  probability distributions <br> of variables defined on cyclic temporal granularities"
type: "contributed"
author: "<br> Sayani Gupta <br> <hr> &nbsp; Prof. Rob J Hyndman &nbsp; &nbsp; Prof. Dianne Cook &nbsp; &nbsp; Dr. Peter Toscas"
date: <font size="5"> Department of Econometrics and Business Statistics <br>  Progress Review <br> March 3, 2020
bgimg: "images/bg1.jpg"
output:
  xaringan::moon_reader:
    after_body: ["libs/collapseoutput.js"]
    css:
      - ninjutsu 
      - "assets/animate.css"
      - "assets/monash-logo.css"
      - "assets/monash-brand.css"
      - "assets/monash-fonts.css"
      - "assets/styles.css" # small improvements
      - "assets/custom.css" # add your own CSS here!
      - "timeline.css"
    # [ "libs/myremark.css", "xaringan-themer.css" , "libs/font-awesome/css/fontawesome-all.css"]
    self_contained: false
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
library(knitr)
options(htmltools.dir.version = FALSE, tibble.width = 55, tibble.print_min = 4)
opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = 'figure/', cache.path = 'cache/', fig.align = 'center', 
  fig.width = 12, fig.show = 'hold', fig.height = 7, # 16:9
  cache = TRUE, external = TRUE, dev = 'svglite',
  results = "markup"
)
read_chunk('R/theme.R')
read_chunk('R/main.R')
```

```{r xaringan-themer, include = FALSE, eval=FALSE}
library(xaringanthemer)
 solarized_dark(
   header_font_google = google_font("Josefin Sans"),
   text_font_google   = google_font("Montserrat", "300", "300i"),
   code_font_google   = google_font("Droid Mono"),
   # header_color = "#00aba9",
   # text_color = "#2b5797"
   # # header_color = "#00008B",
   # text_color = "#8B4513"
  header_color = "#ffbb33",
  # text_color = "#FFDAB9",
  text_color = "White",
  background_color = "#555555",
  #title_slide_background_color = " #D9D690"
 )
```


# Electricity smart meter technology <br> (~ 0.3 billion half hourly observations)

- Source: Department of the Environment and Energy, Australia
<br>
<br>
- Frequency:  Half hourly (interval meter reading (Kwh))
<br>
<br>
- Time Span: 2012 to 2014
<br>
<br>
- Spread: 14K (approx.) households based in Newcastle, New South Wales, and parts of Sydney
<br>
<br>

---

# Raw data from from 2012 - 2014 for 50 households

```{r load}
```


```{r motivation3, out.height="500px"}
```


---
class:center, middle

```{r load-theme}
```


---
class:center, top

#  Research aim 

<br>
<br>
<br>
## <span style="color:firebrick"> How do we systematically explore large quantities of temporal data across different deconstructions of time (half-hour, day, type of day, year) to find regular patterns or anomalies in behavior?

---
class:left, top

#  Research objectives 

.larger[
- Visualizing probability distributions across bivariate cyclic temporal granularities <br><br>
- Clustering temporal data across cyclic granularities based on probability distribution similarity <br><br>
- Study of Australian smart meter data
]
---
class: middle center

<!-- SLIDE 4 -->

.animated.bounce[
<img src="images/gravitas_sticker.png" height=280px>
]

## Visualize probability distributions over different time granularities


---
<!-- SLIDE 5 -->

#  Time granularities - abstractions of time
.pull-left[
### Arrangement
 **<span style="color:firebrick"> <i> Linear</i>  **
 - .smaller[days, weeks, months, years]
 **<span style="color:firebrick"> <i> Cyclic</i>  **
 - .smaller[<i> Circular: </i>  day-of-week, month-of-year]  
 - .smaller[<i> Quasi-circular: </i> day-of-month, week-of-month]
 - .smaller[<i> Aperiodic: </i> public holidays, school vacations]
]
.pull-right[
### Order
**<span style="color:firebrick"> <i> Single-order-up</i>  **
 - .smaller[second-of-minute, hour-of-day]  
**<span style="color:firebrick"> <i> Multiple-order-up</i>  **
 - .smaller[second-of-hour, hour-of-week]

<!-- # ```{r calendar, out.width="100%"} -->
<!-- #  -->
<!-- # ``` -->
]

<!-- --- -->
---
class:left, top

#  Linear time granularities

<font size="4.5">
A linear granularity is a mapping $G$ from the integers to subsets of the time domain such that: <br>  (C1) if $i < j$ and $G(i)$ and $G(j)$ are non-empty, then each element of $G(i)$ is less than all elements of $G(j)$, and <br> (C2) if $i < k < j$ and $G(i)$ and $G(j)$ are non-empty, then $G(k)$ is non-empty.

```{r linear-time, echo=FALSE, out.width="100%"}
knitr::include_graphics("images/linear-arr.png")
```

<!-- <span style="color:Crimson"> (C1) implies that the granules in a linear granularity are non-overlapping and their index order is same as time order -->

<span style="color:Crimson"> The definitions, properties and calendar algebra inadequate for conceptualizing cyclic granularities

<!-- since the linearity imposes a restriction on reflecting periodicity in time -->
.footnote[
_* "A Glossary of Time Granularity Concepts"* by Bettini et al." _
]
---
class: top left

# Computation of cyclic time granularities

**<span style="color:firebrick"> Circular**
<br>

.smaller[
$C_{B, G}(z) = {L}(z\mod P(B, G))$,  $\forall z \in \mathbb{Z}_{\geq 0}$

 ```{r computation1, out.height = "150px"}
```
.checked[
- $z: Index \ set$  
- $B: Day$  
- $G: Week$  
- $P(B, G) = 7$  
]
]
---
class: top left

# Computation of cyclic time granularities

**<span style="color:firebrick"> Quasi-circular**
<br>

.smaller[
$Q_{B, G'}(z) = L(z - \sum_{w=0}^{k-1}\vert T_{w \mod R'} \vert)$, $z \in T_k$

 ```{r computation2, out.height = "150px"}
```
.checked[
- $B: Day$  
- $G': Month$ 
- $G'(w) = \bigcup_{z \in T_w}B(z)$
- $\vert T_w \vert: cardinality \ of \ T_w$.
]
]
---

class: top left

# Computation of cyclic time granularities

**<span style="color:firebrick"> Aperiodic**
<br>

.smaller[
\begin{align}
A_{B, M}(z) &= L(i), z \in T_{i_j}, \forall i \in {1, 2, \dots, n} \\
             &= L(0), \text{otherwise}
\end{align}

 ```{r computation3, out.height = "150px"}
```
.checked[
- $B: Day$  
- $M_{i}(j) = \bigcup_{z \in T_{i_j}}B(z)$
- $M = \bigcup_{i=1}^{n}M_{i}$
- ${\{i_j\}}$  = $j^{\text{th}}$ granule of the $i^{\text{th}}$ linear aperiodic granularity
]
]

---
class:center, top

# Data structure and Graphical mapping


<img src="images/datastructure.png", height = "400px">

---
class:left, top

# Why look at multiple cyclic granularities?
.pull-left[
<!-- <large> $multiple \ cyclic\ granularities \equiv multiple\ perspectives (EDA)$ </large> -->
<br>
### (1) If certain hours of the day within a week are different?
<br>
### (2) If certain days of the week are different for different months?
]
.pull-right[
```{r EDA1, out.width = "200%"}
```
```{r EDA2, out.width = "200%"}
```
]

<!-- Exhaustive sets of visual representation required for multiple perspectives on data? -->


<!-- # Computation of granularities -->

<!-- $z$       : index of a tsibble   -->
<!-- <br> -->
<!-- $x$, $y$  : two units in the hierarchy table with  $order(x) <  order(y)$   -->
<!-- <br> -->
<!-- $f(x, y)$ : accessor function for computing the granularity   -->
<!-- <br> -->
<!-- $c(x, y)$ : a constant which relates x and y   -->
<!-- <br> -->

<!-- #### **Single-order-up** -->
<!-- $$f(x, y) = \lfloor z/c(z,x) \rfloor\mod c(x,y)$$ where $y = x+1$ -->


<!-- #### **Multiple-order-up** -->


<!-- \begin{split} -->
<!-- f(x,y) & = \sum_{i=0}^{order(y) - order(x) - 1} c(x, x+i)(f(x -->
<!--   +i, x+i+1) - 1)\\ -->
<!-- \end{split} -->
<!-- SLIDE 7 -->
---
class:left, top

# Relationship of cyclic granularities

.pull-left[
**<span style="color:firebrick"> <i> Clashes</i>:** pairs leading to empty sets
.x[
* structural
* event-based
* build-based
]

**<span style="color:firebrick"> <i> Harmonies</i>:** pairs leading to no empty sets
.checked[
* aid exploratory data analysis
]
]

.pull-right[

```{r clash}
```

```{r noclash}
```
]
---
class:left, top

<!-- SLIDE 7 -->
# Statistical transformations and geometric objects

.left-column[
.checked[
* basic plot chosen displays distributions
* plot choices dictated by statistical transformations and geometric objects
* enhances different features of the distribution
* equipped with benefits and challenges
]
]

.right-column[
```{r allplot, out.width= "100%"}
```
]
---
class:left, top

<!-- SLIDE 6 -->

# Number of levels on visualization
<!-- If certain  hours of the day are different between weekdays and weekends ? -->

.pull-left[
.checked[

```{r leveltable}

```
<br>
<br>

For example, with too many x-axis levels, avoid ridge plots
]
]

.pull-right[
```{r effectoflevel1, out.width= "100%"}
```

```{r effectoflevel2, out.width= "100%"}
```
]
---
class:left, top

<!-- SLIDE 6 -->
#  Interchanging the mapping

.pull-left[
.checked[
* Items placed in close proximity assumed to be in the same group 
(_Gestalt principles_)
* Different mapping focus on different periodic behaviors
]
]
.pull-right[
```{r effectofreverse1, out.width= "100%"}
```

```{r effectofreverse2, out.width= "100%"}
```
]

---
class:center, top

# R package: gravitas


.center[
### Computation
--- 
.left[
.smaller[
- Compute any cyclic granularity? `create_gran()`
 <br>
- Exhaustive list of granularities to explore? `search_gran()`
 <br>
       ]
       ]
]
 
.pull-left[
<br>
 ### Interaction
 --- 
 .smaller[
- Check if cyclic granularities are harmonies/clashes? `is.harmony()`
<br>
- List of harmonies to explore? `harmony()`
<br>]
 ]
.pull-right[
<br>
### Visualization
--- 
.smaller[
- Plot harmonies? `prob_plot()`
<br>
- Sufficient observations? `gran_obs()`
<br>
- Recommendations on feasibility? `gran_advice()`
 ]
 ]

<!-- class: center,middle -->

<!-- # <span style="color:MediumVioletRed"> Package gravitas </span> -->

<!-- ##   granularity visualization of time series data  -->

<!-- SLIDE 8 -->
---
# Application: Non-temporal case
.left-column[
## Cricket example
.checked[
* data structure
<br>
<br>
* Hierachy table
```{r hierarchy2}
```
]
]
.right-column[
```{r cricket-glimpse}
knitr::include_graphics("images/cricket_data.png")
```
]
---

<!-- SLIDE 9 -->
.left-column[
## Cricket example
.checked[
* data structure
* search granularities `search_gran()`
]
]
.right-column[

```r
cricket_tsibble <- cricket %>%
*  mutate(data_index = row_number()) %>%
*  as_tsibble(index = data_index)
```

```r
* cricket_tsibble %>%
*  search_gran(hierarchy_model, 
*              lowest_unit = "ball",
*               highest_unit =  "match")
```
.pull-left[
```{r search_gran_cric}
```
]
.pull-right[
<br>
<br>
<large>  So there are $^{6} P_2$ =  `r length(combn(6,2))` pair of granularities to look at.
]
]
---

.left-column[
## Cricket example
.checked[
* data structure
* search granularities `search_gran()`
* set of harmonies `harmony()`
]
]
.right-column[
```r
cricket_tsibble %>%
*  harmony(hierarchy_model, 
*          lgran = "ball",
*          ugran =  "match")

```

```{r harmony_gran_cric}
```
### Good news! Only 8 out `r length(combn(6,2))` are harmonies.
]
---

.left-column[
## Cricket example
.checked[
* data structure
* search granularities `search_gran()`
* set of harmonies `harmony()`
* advice `gran_advice()`
]
]
.right-column[

```r
cricket_tsibble %>% 
*  gran_advice("hierarchy_model",
*              "over_inning", 
*              "inning_match")
```
<small>
```{r gran-advice_cric, out.width="100%"}
```
</small>
### <large>  Quantile plots recommended for the harmony pair (over_inning, inning_match) </large>
]
---
.left-column[
## Cricket example
.checked[
* data structure
* search granularities `search_gran()`
* set of harmonies `harmony()`
* advice `gran_advice()`
* visualize harmonies `prob_plot()`
]
]
.right-column[
```r
cricket_tsibble %>% 
filter(batting_team %in% c("Mumbai Indians",
                           "Chennai Super Kings")) %>%
* prob_plot("inning_match",
*            "over_inning",
*            response = "runs_per_over",
*            hierarchy_model,
*            plot_type = "lv")
```

```{r visualise_cric}
```
]
---
# Aperiodic cyclic granularities in cricket
```{r aperiodic_cric, fig.height = 7.5}
```
---
class:left, top

# Clustering temporal data based on <br> probability distributions

## Assumptions
- $C_1: \mathbb{Z}_+ \mapsto \{L_1, L_2, L_3, \dots, L_m \}$
- $C_2: \mathbb{Z}_+ \mapsto \{L_1, L_2, L_3, \dots, L_p \}$
- $S(i, j, k)$: set of measurement variables corresponding to the key $i$ for $k^{th}$ level of $j^{th}$ cyclic granularity
- $P(i, j, k)$: probability distribution of the measured variable corresponding to the set $S(i, j, k)$
- clustering algorithm on $P(i, j, k)$ instead of raw data

---
class:left, top

# Clustering temporal data based on <br> probability distributions

## Implications
- Dimension reduction
- Avoid loss of information due to aggregation
- Robustness to outliers
- Non-synchronized observed time periods
- Similar periodic behavior
- Handling autocorrelation


---
class:left, top

# Study of Australian smart meter data

.smaller[
* Provide preliminary exploratory visualization and summarisation
* Employ cluster analysis to obtain households showing similar periodic behavior and combine the findings with external data like weather conditions, socio-economic or other demographic factors of those households
* Comparative study with earlier methods which focused on clustering raw data across linear time scales as opposed to clustering probability distributions across periodic scales
]
---

.left-column[
## Timeline
### - 2019
]
.right-column[
.timeline.timeline-left.timeline-with-arrows[
.timeline-block[

.timeline-block[
.arrow-right[
.timeline-content[
Internship with Google Summer of Code
.timeline-date[
2019/08
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
Young Statistician's Conference -  
won the 2nd best presentation award `r emo::ji("trophy")`
.timeline-date[
2019/10
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
R package `gravitas` on CRAN
.timeline-date[
2019/11
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
R package `gghdr`: graphing highest density regions at [rOpenSci](https://ropensci.org/) 
.timeline-date[
2019/12
]]]]


.timeline-block[
.arrow-right[
.timeline-content[
International Indian Statistical Association 
.timeline-date[
2019/12
]]]]

]
]
]

---

.left-column[
## Timeline
### - 2019
### - 2020
]
.right-column[
.timeline.timeline-left.purple-flirt.timeline-with-arrows[


.timeline-block[
.arrow-right[
.timeline-content[
Mid-Candidature Review
.timeline-date[
2020/03
]]]]


.timeline-block[
.arrow-right[
.timeline-content[
R package `gghdr` to be submitted on CRAN 
.timeline-date[
2020/03
]]]]


.timeline-block[
.arrow-right[
.timeline-content[
Paper to be submitted to Journal of Computational and Graphical Statistics (JCGS)
.timeline-date[
2020/04
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
useR! 2020 (Tentative)
.timeline-date[
2020/07
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
Compstat 2020 (Tentative)
.timeline-date[
2020/08
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
R package and draft paper of Research objective-2 ready
.timeline-date[
2020/10
]]]]
]
]

---

.left-column[
## Timeline
### - 2019
### - 2020
### - 2021
]

.right-column[
.timeline.timeline-left.purple-flirt.timeline-with-arrows[

.timeline-block[
.arrow-right[
.timeline-content[
Pre-submission Review 
.timeline-date[
2021/03
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
Research objective-3 draft paper ready 
.timeline-date[
2021/03
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
Thesis submission `r emo::ji("v")`
.timeline-date[
2021/06
]]]]
]
]
---
class: center middle 

# Thank you

<br>
## Joint work with Rob J Hyndman & Dianne Cook
<br>
<br>
### <span style="color:black"> Special thanks to NUMBATS
<br>
<br>


.footnote[
Slides created with <i> Rmarkdown, knitr, xaringan, xaringanthemer</i>
]
--

